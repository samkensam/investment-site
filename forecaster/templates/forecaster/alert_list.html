{% extends 'forecaster/base.html' %}

{% block title %}Alerts & Monitoring{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <h1><i class="bi bi-bell"></i> Investment Alerts</h1>
            <div>
                <a href="{% url 'forecaster:check_alerts' %}" class="btn btn-success">
                    <i class="bi bi-check-circle"></i> Check Alerts Now
                </a>
                <a href="{% url 'forecaster:alert_create' %}" class="btn btn-primary">
                    <i class="bi bi-plus-circle"></i> New Alert
                </a>
            </div>
        </div>
    </div>
</div>

{% if notifications %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card border-warning">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0"><i class="bi bi-exclamation-triangle"></i> Recent Notifications</h5>
            </div>
            <div class="card-body">
                {% for notification in notifications %}
                <div class="alert alert-{{ notification.notification_type }} alert-dismissible fade show mb-2" role="alert">
                    <strong>{{ notification.title }}</strong>
                    <p class="mb-0">{{ notification.message }}</p>
                    <small class="text-muted">{{ notification.created_at|date:"M d, Y H:i" }}</small>
                    <a href="{% url 'forecaster:notification_mark_read' notification.pk %}" class="btn-close"></a>
                </div>
                {% endfor %}
                <a href="{% url 'forecaster:notification_list' %}" class="btn btn-sm btn-outline-primary">
                    View All Notifications
                </a>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if alerts %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5><i class="bi bi-list-check"></i> My Alerts</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Alert Name</th>
                                <th>Type</th>
                                <th>Scenario</th>
                                <th>Condition</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for alert in alerts %}
                            <tr>
                                <td>
                                    <strong>{{ alert.name }}</strong>
                                    {% if alert.send_email %}
                                    <i class="bi bi-envelope-fill text-primary" title="Email enabled"></i>
                                    {% endif %}
                                </td>
                                <td><span class="badge bg-info">{{ alert.get_alert_type_display }}</span></td>
                                <td>
                                    {% if alert.scenario %}
                                    <a href="{% url 'forecaster:scenario_detail' alert.scenario.pk %}">
                                        {{ alert.scenario.name }}
                                    </a>
                                    {% else %}
                                    <span class="text-muted">All scenarios</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if alert.target_value %}
                                    Value: ${{ alert.target_value|floatformat:2 }}
                                    {% elif alert.target_roi %}
                                    ROI: {{ alert.target_roi }}%
                                    {% elif alert.reminder_frequency_days %}
                                    Every {{ alert.reminder_frequency_days }} days
                                    {% endif %}
                                </td>
                                <td>
                                    {% if alert.status == 'active' %}
                                    <span class="badge bg-success">Active</span>
                                    {% elif alert.status == 'triggered' %}
                                    <span class="badge bg-warning">Triggered</span>
                                    <br><small class="text-muted">{{ alert.triggered_at|date:"M d, H:i" }}</small>
                                    {% else %}
                                    <span class="badge bg-secondary">Disabled</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <a href="{% url 'forecaster:alert_toggle' alert.pk %}" 
                                           class="btn btn-outline-{% if alert.status == 'active' %}warning{% else %}success{% endif %}"
                                           title="{% if alert.status == 'active' %}Disable{% else %}Enable{% endif %}">
                                            <i class="bi bi-{% if alert.status == 'active' %}pause{% else %}play{% endif %}"></i>
                                        </a>
                                        <a href="{% url 'forecaster:alert_update' alert.pk %}" 
                                           class="btn btn-outline-primary" title="Edit">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                        <a href="{% url 'forecaster:alert_delete' alert.pk %}" 
                                           class="btn btn-outline-danger" title="Delete">
                                            <i class="bi bi-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="card">
    <div class="card-body text-center py-5">
        <i class="bi bi-bell-slash" style="font-size: 4rem; color: #dee2e6;"></i>
        <h3 class="mt-3">No Alerts Yet</h3>
        <p class="text-muted">Set up alerts to monitor your investment goals and milestones!</p>
        <a href="{% url 'forecaster:alert_create' %}" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Create Your First Alert
        </a>
    </div>
</div>
{% endif %}

<div class="row mt-4">
    <div class="col-12">
        <div class="card bg-light">
            <div class="card-body">
                <h5><i class="bi bi-info-circle"></i> How Alerts Work</h5>
                <ul>
                    <li><strong>Milestone Alerts:</strong> Get notified when your portfolio reaches a specific value</li>
                    <li><strong>ROI Alerts:</strong> Track when your return on investment hits a target percentage</li>
                    <li><strong>Threshold Alerts:</strong> Monitor when values cross important thresholds</li>
                    <li><strong>Reminders:</strong> Periodic notifications to review your investments</li>
                </ul>
                <p class="mb-0"><small class="text-muted">
                    Alerts are checked manually via "Check Alerts Now" button or automatically when scenarios are updated.
                </small></p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
